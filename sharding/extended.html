<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from discordjs.guide/sharding/extended.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 17 Jan 2021 09:05:05 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Extended changes | Discord.js Guide</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="../favicon.png">
    <meta name="description" content="A guide made by the community of discord.js for its users.">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#42b983">
    <meta name="twitter:card" content="summary">
    <meta name="og:title" content="Discord.js Guide">
    <meta name="og:description" content="A guide made by the community of discord.js for its users.">
    <meta name="og:type" content="website">
    <meta name="og:url" content="../index.html">
    <meta name="og:locale" content="en_US">
    <meta name="og:image" content="../meta-image.png">
    <link rel="preload" href="../assets/css/0.styles.c81fdb25.css" as="style"><link rel="preload" href="../assets/js/app.1b16820c.js" as="script"><link rel="preload" href="../assets/js/4.58143105.js" as="script"><link rel="preload" href="../assets/js/62.ee2671f7.js" as="script"><link rel="preload" href="../assets/js/16.e90c1593.js" as="script"><link rel="preload" href="../assets/js/22.549d06f2.js" as="script"><link rel="preload" href="../assets/js/6.1ed8886a.js" as="script"><link rel="prefetch" href="../assets/js/1.4966f13b.js"><link rel="prefetch" href="../assets/js/10.d9e5e65a.js"><link rel="prefetch" href="../assets/js/11.4d024292.js"><link rel="prefetch" href="../assets/js/12.0ebfb6b5.js"><link rel="prefetch" href="../assets/js/13.ec6ebc85.js"><link rel="prefetch" href="../assets/js/14.e0c1c3e6.js"><link rel="prefetch" href="../assets/js/15.468032d7.js"><link rel="prefetch" href="../assets/js/17.48dc860b.js"><link rel="prefetch" href="../assets/js/18.66fb5b1b.js"><link rel="prefetch" href="../assets/js/19.267ae342.js"><link rel="prefetch" href="../assets/js/20.c083e492.js"><link rel="prefetch" href="../assets/js/21.c20bf682.js"><link rel="prefetch" href="../assets/js/23.97219136.js"><link rel="prefetch" href="../assets/js/24.597d3784.js"><link rel="prefetch" href="../assets/js/25.e66ea496.js"><link rel="prefetch" href="../assets/js/26.3e94b2e9.js"><link rel="prefetch" href="../assets/js/27.c1f13a28.js"><link rel="prefetch" href="../assets/js/28.7159a662.js"><link rel="prefetch" href="../assets/js/29.d4774ef2.js"><link rel="prefetch" href="../assets/js/30.90995d89.js"><link rel="prefetch" href="../assets/js/31.de2dcdf7.js"><link rel="prefetch" href="../assets/js/32.a19a8a69.js"><link rel="prefetch" href="../assets/js/33.d3547ea6.js"><link rel="prefetch" href="../assets/js/34.999b3eb5.js"><link rel="prefetch" href="../assets/js/35.8165c07f.js"><link rel="prefetch" href="../assets/js/36.2b277f69.js"><link rel="prefetch" href="../assets/js/37.3ea48fb0.js"><link rel="prefetch" href="../assets/js/38.c2159f22.js"><link rel="prefetch" href="../assets/js/39.50884a19.js"><link rel="prefetch" href="../assets/js/40.a8990f37.js"><link rel="prefetch" href="../assets/js/41.701c8a9b.js"><link rel="prefetch" href="../assets/js/42.b84d3fd9.js"><link rel="prefetch" href="../assets/js/43.5faf8a11.js"><link rel="prefetch" href="../assets/js/44.13615e3c.js"><link rel="prefetch" href="../assets/js/45.487383a0.js"><link rel="prefetch" href="../assets/js/46.9ed01b37.js"><link rel="prefetch" href="../assets/js/47.9f485986.js"><link rel="prefetch" href="../assets/js/48.8f87e54d.js"><link rel="prefetch" href="../assets/js/49.03b932fc.js"><link rel="prefetch" href="../assets/js/5.a0132f30.js"><link rel="prefetch" href="../assets/js/50.6ecc158d.js"><link rel="prefetch" href="../assets/js/51.ed256bb5.js"><link rel="prefetch" href="../assets/js/52.8aa55e0d.js"><link rel="prefetch" href="../assets/js/53.b92566e2.js"><link rel="prefetch" href="../assets/js/54.aa72db74.js"><link rel="prefetch" href="../assets/js/55.43db0b13.js"><link rel="prefetch" href="../assets/js/56.99a95047.js"><link rel="prefetch" href="../assets/js/57.36019a3d.js"><link rel="prefetch" href="../assets/js/58.bbb4a297.js"><link rel="prefetch" href="../assets/js/59.83d011b0.js"><link rel="prefetch" href="../assets/js/60.8138be15.js"><link rel="prefetch" href="../assets/js/61.f92820ad.js"><link rel="prefetch" href="../assets/js/63.9ec4fce9.js"><link rel="prefetch" href="../assets/js/64.dde77080.js"><link rel="prefetch" href="../assets/js/65.c59bb07d.js"><link rel="prefetch" href="../assets/js/66.37172aa5.js"><link rel="prefetch" href="../assets/js/67.81b25533.js"><link rel="prefetch" href="../assets/js/68.af678c1d.js"><link rel="prefetch" href="../assets/js/7.97abf805.js"><link rel="prefetch" href="../assets/js/8.1ad597e1.js"><link rel="prefetch" href="../assets/js/9.d00e8d4e.js"><link rel="prefetch" href="../assets/js/vendors_docsearch.d31fbf91.js">
    <link rel="stylesheet" href="../assets/css/0.styles.c81fdb25.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="../index.html" class="home-link router-link-active"><!----> <span class="site-name">Discord.js Guide</span></a> <div class="links"><!----> <div class="user-settings"><a href="#" class="settings-button"><svg aria-hidden="true" data-prefix="fas" data-icon="cog" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-cog fa-w-16 settings-icon"><path fill="currentColor" d="M444.788 291.1l42.616 24.599c4.867 2.809 7.126 8.618 5.459 13.985-11.07 35.642-29.97 67.842-54.689 94.586a12.016 12.016 0 0 1-14.832 2.254l-42.584-24.595a191.577 191.577 0 0 1-60.759 35.13v49.182a12.01 12.01 0 0 1-9.377 11.718c-34.956 7.85-72.499 8.256-109.219.007-5.49-1.233-9.403-6.096-9.403-11.723v-49.184a191.555 191.555 0 0 1-60.759-35.13l-42.584 24.595a12.016 12.016 0 0 1-14.832-2.254c-24.718-26.744-43.619-58.944-54.689-94.586-1.667-5.366.592-11.175 5.459-13.985L67.212 291.1a193.48 193.48 0 0 1 0-70.199l-42.616-24.599c-4.867-2.809-7.126-8.618-5.459-13.985 11.07-35.642 29.97-67.842 54.689-94.586a12.016 12.016 0 0 1 14.832-2.254l42.584 24.595a191.577 191.577 0 0 1 60.759-35.13V25.759a12.01 12.01 0 0 1 9.377-11.718c34.956-7.85 72.499-8.256 109.219-.007 5.49 1.233 9.403 6.096 9.403 11.723v49.184a191.555 191.555 0 0 1 60.759 35.13l42.584-24.595a12.016 12.016 0 0 1 14.832 2.254c24.718 26.744 43.619 58.944 54.689 94.586 1.667 5.366-.592 11.175-5.459 13.985L444.788 220.9a193.485 193.485 0 0 1 0 70.2zM336 256c0-44.112-35.888-80-80-80s-80 35.888-80 80 35.888 80 80 80 80-35.888 80-80z"></path></svg></a> <div class="user-settings-menu" style="display:none;"><div class="theme-options"><!----> <!----> <div class="dark-theme-options toggle-option"><label for="dark-theme-toggle">Enable Dark Theme?</label> <input id="dark-theme-toggle" type="checkbox"></div> <!----> <!----></div></div></div> <!----> <form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="../index.html" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="../commando/index.html" class="nav-link">
  Commando
</a></div><div class="nav-item"><a href="https://discord.js.org/#/docs/main/stable/general/welcome" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord.js Documentation
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/discordjs/guide" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="../index.html" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="../commando/index.html" class="nav-link">
  Commando
</a></div><div class="nav-item"><a href="https://discord.js.org/#/docs/main/stable/general/welcome" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord.js Documentation
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/discordjs/guide" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Home</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../index.html" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="../requesting-more-content.html" class="sidebar-link">Requesting more content</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Installations &amp; Preparations</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../preparations/index.html" class="sidebar-link">Installing Node.js and discord.js</a></li><li><a href="../preparations/setting-up-a-linter.html" class="sidebar-link">Setting up a linter</a></li><li><a href="../preparations/setting-up-a-bot-application.html" class="sidebar-link">Setting up a bot application</a></li><li><a href="../preparations/adding-your-bot-to-servers.html" class="sidebar-link">Adding your bot to servers</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Creating Your Bot</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../creating-your-bot/index.html" class="sidebar-link">Getting your bot up &amp; running</a></li><li><a href="../creating-your-bot/configuration-files.html" class="sidebar-link">Configuration files</a></li><li><a href="../creating-your-bot/adding-more-commands.html" class="sidebar-link">Adding more commands</a></li><li><a href="../creating-your-bot/commands-with-user-input.html" class="sidebar-link">Commands with user input (a.k.a. &quot;arguments&quot;)</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Command Handler</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../command-handling/index.html" class="sidebar-link">Command handling</a></li><li><a href="../command-handling/dynamic-commands.html" class="sidebar-link">Dynamic commands</a></li><li><a href="../command-handling/adding-features.html" class="sidebar-link">Additional features</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Popular Topics</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../popular-topics/faq.html" class="sidebar-link">Frequently asked Questions</a></li><li><a href="../popular-topics/embeds.html" class="sidebar-link">Embeds</a></li><li><a href="../popular-topics/errors.html" class="sidebar-link">Errors</a></li><li><a href="../popular-topics/permissions.html" class="sidebar-link">Permissions</a></li><li><a href="../popular-topics/permissions-extended.html" class="sidebar-link">Permissions (extended)</a></li><li><a href="../popular-topics/reactions.html" class="sidebar-link">Reactions</a></li><li><a href="../popular-topics/collectors.html" class="sidebar-link">Collectors</a></li><li><a href="../popular-topics/partials.html" class="sidebar-link">Partial Structures</a></li><li><a href="../popular-topics/intents.html" class="sidebar-link">Gateway Intents</a></li><li><a href="../popular-topics/canvas.html" class="sidebar-link">Image manipulation with Canvas</a></li><li><a href="../popular-topics/webhooks.html" class="sidebar-link">Webhooks</a></li><li><a href="../popular-topics/audit-logs.html" class="sidebar-link">Working with Audit Logs</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Miscellaneous</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../miscellaneous/parsing-mention-arguments.html" class="sidebar-link">Parsing mention arguments</a></li><li><a href="../miscellaneous/useful-packages.html" class="sidebar-link">Useful packages</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Databases</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../sequelize/index.html" class="sidebar-link">Storing data with Sequelize</a></li><li><a href="../sequelize/currency.html" class="sidebar-link">Making a Currency System</a></li><li><a href="../keyv/index.html" class="sidebar-link">Storing data with Keyv</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Sharding</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="index.html" aria-current="page" class="sidebar-link">Getting started</a></li><li><a href="additional-information.html" class="sidebar-link">Additional information</a></li><li><a href="extended.html" aria-current="page" class="active sidebar-link">Extended changes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="extended.html#extended-changes" class="sidebar-link">Extended changes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="extended.html#sending-messages-across-shards" class="sidebar-link">Sending messages across shards</a></li><li class="sidebar-sub-header"><a href="extended.html#using-functions-continued" class="sidebar-link">Using functions continued</a></li></ul></li><li class="sidebar-sub-header"><a href="extended.html#resulting-code" class="sidebar-link">Resulting code</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>OAuth2</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../oauth2/index.html" class="sidebar-link">Getting started with OAuth2</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Voice</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../voice/index.html" class="sidebar-link">Introduction</a></li><li><a href="../voice/understanding-voice.html" class="sidebar-link">Understanding Voice</a></li><li><a href="../voice/the-basics.html" class="sidebar-link">The Basics</a></li><li><a href="../voice/voice-broadcasts.html" class="sidebar-link">Voice Broadcasts</a></li><li><a href="../voice/optimisation-and-troubleshooting.html" class="sidebar-link">Optimization and Troubleshooting</a></li><li><a href="../voice/receiving-audio.html" class="sidebar-link">Receiving Audio</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Improving Your Dev Environment</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../improving-dev-environment/pm2.html" class="sidebar-link">Managing your bot process with PM2</a></li><li><a href="../improving-dev-environment/package-json-scripts.html" class="sidebar-link">Setting up package.json scripts</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Additional Information</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../additional-info/notation.html" class="sidebar-link">Understanding notation</a></li><li><a href="../additional-info/es6-syntax.html" class="sidebar-link">ES6 syntax examples</a></li><li><a href="../additional-info/collections.html" class="sidebar-link">Collections</a></li><li><a href="../additional-info/async-await.html" class="sidebar-link">Understanding async/await</a></li><li><a href="../additional-info/rest-api.html" class="sidebar-link">Using a REST API</a></li><li><a href="../additional-info/changes-in-v12.html" class="sidebar-link">Updating from v11 to v12</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="extended-changes"><a href="#extended-changes" class="header-anchor">#</a> Extended changes</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>This page is a follow-up and bases its code off of <a href="additional-information.html">the previous page</a>, which assumes knowledge of arguments and passing functions.</p></div> <h3 id="sending-messages-across-shards"><a href="#sending-messages-across-shards" class="header-anchor">#</a> Sending messages across shards</h3> <p>Let's start off with a basic usage with shards. At some point in bot development, you might have wanted to send a message to another channel, which may or may not necessarily be on the same guild, which means it may or may not be on the same shard. To remedy this, you will need to go back to your friend <code>.broadcastEval()</code> and try every shard for the desired channel. Suppose you have the following code in your <code>message</code> event:</p> <span style="display:none;"><div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token parameter">message</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>message<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span> <span class="token operator">||</span> message<span class="token punctuation">.</span>author<span class="token punctuation">.</span>bot<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

	<span class="token keyword">const</span> args <span class="token operator">=</span> message<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>prefix<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/ +/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> command <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">===</span> <span class="token string">'send'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>args<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span> message<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">'please specify a destination channel id.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">const</span> channel <span class="token operator">=</span> client<span class="token punctuation">.</span>channels<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>channel<span class="token punctuation">)</span> <span class="token keyword">return</span> message<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">'I could not find such a channel.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> message<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">I have sent a message to channel \`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\`!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></span> <span style="display:block;"><div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token parameter">message</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>message<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span> <span class="token operator">||</span> message<span class="token punctuation">.</span>author<span class="token punctuation">.</span>bot<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

	<span class="token keyword">const</span> args <span class="token operator">=</span> message<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>prefix<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/ +/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> command <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">===</span> <span class="token string">'send'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>args<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span> message<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">'please specify a destination channel id.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">const</span> channel <span class="token operator">=</span> client<span class="token punctuation">.</span>channels<span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>channel<span class="token punctuation">)</span> <span class="token keyword">return</span> message<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">'I could not find such a channel.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> message<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">I have sent a message to channel \`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\`!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></span> <p>This will never work for a channel that lies on another shard. So, let's remedy this.</p> <span style="display:none;"><div class="language-diff extra-class"><pre class="language-diff"><code>	if (command === 'send') {
		if (!args.length) return message.reply('please specify a destination channel id.');

<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">		const channel = client.channels.get(args[0]);
</span><span class="token prefix deleted">-</span><span class="token line">		if (!channel) return message.reply('I could not find such a channel.');
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">		channel.send('Hello!');
</span><span class="token prefix deleted">-</span><span class="token line">		return message.reply(`I have sent a message to channel \`${args[0]}\`!`);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">		return client.shard.broadcastEval(`
</span><span class="token prefix inserted">+</span><span class="token line">			const channel = this.channels.get('${args[0]}');
</span><span class="token prefix inserted">+</span><span class="token line">			if (channel) {
</span><span class="token prefix inserted">+</span><span class="token line">				channel.send('This is a message from shard ${this.shard.id}!');
</span><span class="token prefix inserted">+</span><span class="token line">				true;
</span><span class="token prefix inserted">+</span><span class="token line">			}
</span><span class="token prefix inserted">+</span><span class="token line">			else {
</span><span class="token prefix inserted">+</span><span class="token line">				false;
</span><span class="token prefix inserted">+</span><span class="token line">			}
</span><span class="token prefix inserted">+</span><span class="token line">		`)
</span><span class="token prefix inserted">+</span><span class="token line">			.then(console.log);
</span></span>	}
</code></pre></div></span> <span style="display:block;"><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>In version 12 <a href="https://discord.js.org/#/docs/main/stable/class/ShardClientUtil?scrollTo=ids" target="_blank" rel="noopener noreferrer"><code>client.shard</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> can hold multiple ids. If you use the default sharding manager the <code>.ids</code> array will only have one entry.</p></div> <div class="language-diff extra-class"><pre class="language-diff"><code>	if (command === 'send') {
		if (!args.length) return message.reply('please specify a destination channel id.');

<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">		const channel = client.channels.cache.get(args[0]);
</span><span class="token prefix deleted">-</span><span class="token line">		if (!channel) return message.reply('I could not find such a channel.');
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">		channel.send('Hello!');
</span><span class="token prefix deleted">-</span><span class="token line">		return message.reply(`I have sent a message to channel \`${args[0]}\`!`);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">		return client.shard.broadcastEval(`
</span><span class="token prefix inserted">+</span><span class="token line">			const channel = this.channels.cache.get('${args[0]}');
</span><span class="token prefix inserted">+</span><span class="token line">			if (channel) {
</span><span class="token prefix inserted">+</span><span class="token line">				channel.send('This is a message from shard ${this.shard.ids.join(',')}!');
</span><span class="token prefix inserted">+</span><span class="token line">				true;
</span><span class="token prefix inserted">+</span><span class="token line">			}
</span><span class="token prefix inserted">+</span><span class="token line">			else {
</span><span class="token prefix inserted">+</span><span class="token line">				false;
</span><span class="token prefix inserted">+</span><span class="token line">			}
</span><span class="token prefix inserted">+</span><span class="token line">		`)
</span><span class="token prefix inserted">+</span><span class="token line">			.then(console.log);
</span></span>	}
</code></pre></div></span> <p>If all is well, then you should notice an output like the following: <code>[false, true, false, false]</code>. If it is not clear why <code>true</code> and <code>false</code> are hanging around, it's because the last expression of the eval statement is what will be returned. You will want this if you want any feedback in the results. Now that you have observed said results, you can adjust the command to give yourself proper feedback, like so:</p> <span style="display:none;"><div class="language-diff extra-class"><pre class="language-diff"><code>	return client.shard.broadcastEval(`
		const channel = this.channels.get('${args[0]}');
		if (channel) {
			channel.send('This is a message from shard ${this.shard.id}!');
			true;
		}
		else {
			false;
		}
	`)
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">		.then(console.log);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">		.then(sentArray =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">			// Search for a non falsy value before providing feedback
</span><span class="token prefix inserted">+</span><span class="token line">			if (!sentArray.includes(true)) {
</span><span class="token prefix inserted">+</span><span class="token line">				return message.reply('I could not find such a channel.');
</span><span class="token prefix inserted">+</span><span class="token line">			}
</span></span>
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">			return message.reply(`I have sent a message to channel \`${args[0]}\`!`);
</span><span class="token prefix inserted">+</span><span class="token line">		});
</span></span></code></pre></div></span> <span style="display:block;"><div class="language-diff extra-class"><pre class="language-diff"><code>	return client.shard.broadcastEval(`
		const channel = this.channels.cache.get('${args[0]}');
		if (channel) {
			channel.send('This is a message from shard ${this.shard.id}!');
			true;
		}
		else {
			false;
		}
	`)
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">		.then(console.log);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">		.then(sentArray =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">			// Search for a non falsy value before providing feedback
</span><span class="token prefix inserted">+</span><span class="token line">			if (!sentArray.includes(true)) {
</span><span class="token prefix inserted">+</span><span class="token line">				return message.reply('I could not find such a channel.');
</span><span class="token prefix inserted">+</span><span class="token line">			}
</span></span>
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">			return message.reply(`I have sent a message to channel \`${args[0]}\`!`);
</span><span class="token prefix inserted">+</span><span class="token line">		});
</span></span></code></pre></div></span> <p>And that's it for this section! You have successfully communicated across all of your shards.</p> <h3 id="using-functions-continued"><a href="#using-functions-continued" class="header-anchor">#</a> Using functions continued</h3> <p>If you remember, there was a brief mention of passing functions through <code>.broadcastEval()</code>, but no super clear description of exactly how to go about it. Well, fret not, for it will be covered in this section! Suppose you have the following code in your <code>message</code> event:</p> <span style="display:none;"><div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token parameter">message</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>message<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span> <span class="token operator">||</span> message<span class="token punctuation">.</span>author<span class="token punctuation">.</span>bot<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

	<span class="token keyword">const</span> args <span class="token operator">=</span> message<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>prefix<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/ +/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> command <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">===</span> <span class="token string">'emoji'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>args<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span> message<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">'please specify an emoji id to search for.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> emoji <span class="token operator">=</span> client<span class="token punctuation">.</span>emojis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">return</span> message<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">I have found an emoji </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>emoji<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></span> <span style="display:block;"><div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token parameter">message</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>message<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span> <span class="token operator">||</span> message<span class="token punctuation">.</span>author<span class="token punctuation">.</span>bot<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

	<span class="token keyword">const</span> args <span class="token operator">=</span> message<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>prefix<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/ +/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> command <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">===</span> <span class="token string">'emoji'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>args<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span> message<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">'please specify an emoji id to search for.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> emoji <span class="token operator">=</span> client<span class="token punctuation">.</span>emojis<span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">return</span> message<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">I have found an emoji </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>emoji<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></span> <p>The aforementioned code will essentially search through <span style="display:none;"><code>client.emojis</code></span><span style="display:inline-block;"><code>client.emojis.cache</code></span> for the provided id, which will be given with <code>args[0]</code>. However, with sharding, you might notice it doesn't search through all the emojis the client actually has. As mentioned in an earlier section of this guide, this is due to the client being split up into different shards, so each shard has its own cache. Emojis are derived from guilds, so each shard will have the emojis from all of the guilds for that shard. The solution is to use <code>.broadcastEval()</code> to search all the shards for the desired emoji. However, in the interest of providing an example on using functions, you will make use of one here. Consider that when something is evaluated, it is ran in the context of the <code>client</code>, which means <code>this</code> represents the current client for that shard.</p> <p>Let's start off with an extremely basic function, which will try to grab an emoji from the current client and return it.</p> <span style="display:none;"><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">findEmoji</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> emoji <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>emojis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>emoji<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> emoji<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></span> <span style="display:block;"><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">findEmoji</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> emoji <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>emojis<span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>emoji<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> emoji<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></span> <p>Next, you need to properly call the function in your command. If you recall from <a href="additional-information.html#eval-arguments">this section</a>, it is shown there how to pass a function and arguments correctly. <code>.call()</code> will also be used in order to preserve the <code>client</code> context in the function that is passed through.</p> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token parameter">message</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>message<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span> <span class="token operator">||</span> message<span class="token punctuation">.</span>author<span class="token punctuation">.</span>bot<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

	<span class="token keyword">const</span> args <span class="token operator">=</span> message<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>prefix<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/ +/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> command <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">===</span> <span class="token string">'emoji'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>args<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span> message<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">'please specify an emoji id to search for.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">return</span> client<span class="token punctuation">.</span>shard<span class="token punctuation">.</span><span class="token function">broadcastEval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>findEmoji<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">).call(this, '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">')</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If you are unsure as to what <code>.call()</code> does, you may read up on it <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/call" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></div> <p>Now, run this code, and you will surely get a result that looks like the following:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span> <span class="token punctuation">{</span> guild<span class="token operator">:</span>
     <span class="token punctuation">{</span> members<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
       <span class="token comment">// ...</span>
       id<span class="token operator">:</span> <span class="token string">'222078108977594368'</span><span class="token punctuation">,</span>
       name<span class="token operator">:</span> <span class="token string">'Discord.js Official'</span><span class="token punctuation">,</span>
       icon<span class="token operator">:</span> <span class="token string">'6e4b4d1a0c7187f9fd5d4976c50ac96e'</span><span class="token punctuation">,</span>
       <span class="token comment">// ...</span>
       emojis<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    id<span class="token operator">:</span> <span class="token string">'383735055509356544'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'duckSmug'</span><span class="token punctuation">,</span>
    requiresColons<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    managed<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    animated<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    _roles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span>
</code></pre></div><p>While this result isn't <em>necessarily</em> bad or incorrect, it's simply a raw object that got <code>JSON.parse()</code>'d and <code>JSON.stringify()</code>'d over, so all of the circular references are gone. More importantly, The object is no longer a true <span style="display:none;"><code>Emoji</code></span><span style="display:inline-block;"><code>GuildEmoji</code></span> object as provided by discord.js. This means none of the convenience methods usually provided to you are available. If this is not a concern to you, then you can effectively skip the rest of this section. However, this is a tutorial, so it should be covered regardless! Let's remedy this issue, shall we?</p> <span style="display:none;"><div class="language-diff extra-class"><pre class="language-diff"><code>function findEmoji(id) {
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">	const emoji = this.emojis.get(id);	
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">	const temp = this.emojis.get(id);
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">	if (!emoji) return null;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">	if (!temp) return null;
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">	// Clone the object because it is modified right after, so as to not affect the cache in client.emojis
</span><span class="token prefix inserted">+</span><span class="token line">	const emoji = Object.assign({}, temp);
</span><span class="token prefix inserted">+</span><span class="token line">	// Circular references can't be returned outside of eval, so change it to the id
</span><span class="token prefix inserted">+</span><span class="token line">	if (emoji.guild) emoji.guild = emoji.guild.id;
</span><span class="token prefix inserted">+</span><span class="token line">	// A new object will be constructed, so simulate raw data by adding this property back
</span><span class="token prefix inserted">+</span><span class="token line">	emoji.require_colons = emoji.requiresColons;
</span><span class="token prefix inserted">+</span><span class="token line">
</span></span>	return emoji;
}
</code></pre></div></span> <span style="display:block;"><div class="language-diff extra-class"><pre class="language-diff"><code>function findEmoji(id) {
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">	const emoji = this.emojis.cache.get(id);	
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">	const temp = this.emojis.cache.get(id);
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">	if (!emoji) return null;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">	if (!temp) return null;
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">	// Clone the object because it is modified right after, so as to not affect the cache in client.emojis
</span><span class="token prefix inserted">+</span><span class="token line">	const emoji = Object.assign({}, temp);
</span><span class="token prefix inserted">+</span><span class="token line">	// Circular references can't be returned outside of eval, so change it to the id
</span><span class="token prefix inserted">+</span><span class="token line">	if (emoji.guild) emoji.guild = emoji.guild.id;
</span><span class="token prefix inserted">+</span><span class="token line">	// A new object will be constructed, so simulate raw data by adding this property back
</span><span class="token prefix inserted">+</span><span class="token line">	emoji.require_colons = emoji.requiresColons;
</span><span class="token prefix inserted">+</span><span class="token line">
</span></span>	return emoji;
}
</code></pre></div></span> <p>Now, you will want to make use of it in the actual command:</p> <span style="display:none;"><div class="language-diff extra-class"><pre class="language-diff"><code>	return client.shard.broadcastEval(`(${findEmoji}).call(this, '${args[0]}')`)
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">		.then(console.log);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">		.then(emojiArray =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">			// Locate a non falsy result, which will be the emoji in question
</span><span class="token prefix inserted">+</span><span class="token line">			const foundEmoji = emojiArray.find(emoji =&gt; emoji);
</span><span class="token prefix inserted">+</span><span class="token line">			if (!foundEmoji) return message.reply('I could not find such an emoji.');
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">			// Acquire a guild that can be reconstructed with discord.js
</span><span class="token prefix inserted">+</span><span class="token line">			return client.rest.makeRequest('get', Discord.Constants.Endpoints.Guild(foundEmoji.guild).toString(), true)
</span><span class="token prefix inserted">+</span><span class="token line">					.then(raw =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">						// Reconstruct a guild
</span><span class="token prefix inserted">+</span><span class="token line">						const guild = new Discord.Guild(client, raw);
</span><span class="token prefix inserted">+</span><span class="token line">						// Reconstruct an emoji object as required by discord.js
</span><span class="token prefix inserted">+</span><span class="token line">						const emoji = new Discord.Emoji(guild, foundEmoji);
</span><span class="token prefix inserted">+</span><span class="token line">						return message.reply(`I have found an emoji ${emoji.toString()}!`);
</span><span class="token prefix inserted">+</span><span class="token line">					});
</span><span class="token prefix inserted">+</span><span class="token line">		});
</span></span></code></pre></div></span> <span style="display:block;"><div class="language-diff extra-class"><pre class="language-diff"><code>	return client.shard.broadcastEval(`(${findEmoji}).call(this, '${args[0]}')`)
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">		.then(console.log);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">		.then(emojiArray =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">			// Locate a non falsy result, which will be the emoji in question
</span><span class="token prefix inserted">+</span><span class="token line">			const foundEmoji = emojiArray.find(emoji =&gt; emoji);
</span><span class="token prefix inserted">+</span><span class="token line">			if (!foundEmoji) return message.reply('I could not find such an emoji.');
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">			// Acquire a guild that can be reconstructed with discord.js
</span><span class="token prefix inserted">+</span><span class="token line">			return client.api.guilds(foundEmoji.guild).get()
</span><span class="token prefix inserted">+</span><span class="token line">					.then(raw =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">						// Reconstruct a guild
</span><span class="token prefix inserted">+</span><span class="token line">						const guild = new Discord.Guild(client, raw);
</span><span class="token prefix inserted">+</span><span class="token line">						// Reconstruct an emoji object as required by discord.js
</span><span class="token prefix inserted">+</span><span class="token line">						const emoji = new Discord.GuildEmoji(client, foundEmoji, guild);
</span><span class="token prefix inserted">+</span><span class="token line">						return message.reply(`I have found an emoji ${emoji.toString()}!`);
</span><span class="token prefix inserted">+</span><span class="token line">					});
</span><span class="token prefix inserted">+</span><span class="token line">		});
</span></span></code></pre></div></span> <p>And that's all! The emoji should have pretty-printed in a message as you'd expect.</p> <h2 id="resulting-code"><a href="#resulting-code" class="header-anchor">#</a> Resulting code</h2> <p>
	If you want to compare your code to the code we've constructed so far, you can review it over on the GitHub repository
	<a href="https://github.com/discordjs/guide/tree/master/code-samples/" target="_blank" rel="noopener noreferrer">
		here <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.
</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/discordjs/guide/edit/master/guide/sharding/extended.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/11/2020, 11:51:19 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="additional-information.html" class="prev">
        Additional information
      </a></span> <span class="next"><a href="../oauth2/index.html">
        Getting started with OAuth2
      </a>
      
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="../assets/js/app.1b16820c.js" defer></script><script src="../assets/js/4.58143105.js" defer></script><script src="../assets/js/62.ee2671f7.js" defer></script><script src="../assets/js/16.e90c1593.js" defer></script><script src="../assets/js/22.549d06f2.js" defer></script><script src="../assets/js/6.1ed8886a.js" defer></script>
  </body>

<!-- Mirrored from discordjs.guide/sharding/extended.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 17 Jan 2021 09:05:05 GMT -->
</html>

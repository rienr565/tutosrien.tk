<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from discordjs.guide/sharding/ by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 17 Jan 2021 09:05:05 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Getting started | Discord.js Guide</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="../favicon.png">
    <meta name="description" content="A guide made by the community of discord.js for its users.">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#42b983">
    <meta name="twitter:card" content="summary">
    <meta name="og:title" content="Discord.js Guide">
    <meta name="og:description" content="A guide made by the community of discord.js for its users.">
    <meta name="og:type" content="website">
    <meta name="og:url" content="../index.html">
    <meta name="og:locale" content="en_US">
    <meta name="og:image" content="../meta-image.png">
    <link rel="preload" href="../assets/css/0.styles.c81fdb25.css" as="style"><link rel="preload" href="../assets/js/app.1b16820c.js" as="script"><link rel="preload" href="../assets/js/4.58143105.js" as="script"><link rel="preload" href="../assets/js/60.8138be15.js" as="script"><link rel="preload" href="../assets/js/16.e90c1593.js" as="script"><link rel="preload" href="../assets/js/22.549d06f2.js" as="script"><link rel="preload" href="../assets/js/6.1ed8886a.js" as="script"><link rel="prefetch" href="../assets/js/1.4966f13b.js"><link rel="prefetch" href="../assets/js/10.d9e5e65a.js"><link rel="prefetch" href="../assets/js/11.4d024292.js"><link rel="prefetch" href="../assets/js/12.0ebfb6b5.js"><link rel="prefetch" href="../assets/js/13.ec6ebc85.js"><link rel="prefetch" href="../assets/js/14.e0c1c3e6.js"><link rel="prefetch" href="../assets/js/15.468032d7.js"><link rel="prefetch" href="../assets/js/17.48dc860b.js"><link rel="prefetch" href="../assets/js/18.66fb5b1b.js"><link rel="prefetch" href="../assets/js/19.267ae342.js"><link rel="prefetch" href="../assets/js/20.c083e492.js"><link rel="prefetch" href="../assets/js/21.c20bf682.js"><link rel="prefetch" href="../assets/js/23.97219136.js"><link rel="prefetch" href="../assets/js/24.597d3784.js"><link rel="prefetch" href="../assets/js/25.e66ea496.js"><link rel="prefetch" href="../assets/js/26.3e94b2e9.js"><link rel="prefetch" href="../assets/js/27.c1f13a28.js"><link rel="prefetch" href="../assets/js/28.7159a662.js"><link rel="prefetch" href="../assets/js/29.d4774ef2.js"><link rel="prefetch" href="../assets/js/30.90995d89.js"><link rel="prefetch" href="../assets/js/31.de2dcdf7.js"><link rel="prefetch" href="../assets/js/32.a19a8a69.js"><link rel="prefetch" href="../assets/js/33.d3547ea6.js"><link rel="prefetch" href="../assets/js/34.999b3eb5.js"><link rel="prefetch" href="../assets/js/35.8165c07f.js"><link rel="prefetch" href="../assets/js/36.2b277f69.js"><link rel="prefetch" href="../assets/js/37.3ea48fb0.js"><link rel="prefetch" href="../assets/js/38.c2159f22.js"><link rel="prefetch" href="../assets/js/39.50884a19.js"><link rel="prefetch" href="../assets/js/40.a8990f37.js"><link rel="prefetch" href="../assets/js/41.701c8a9b.js"><link rel="prefetch" href="../assets/js/42.b84d3fd9.js"><link rel="prefetch" href="../assets/js/43.5faf8a11.js"><link rel="prefetch" href="../assets/js/44.13615e3c.js"><link rel="prefetch" href="../assets/js/45.487383a0.js"><link rel="prefetch" href="../assets/js/46.9ed01b37.js"><link rel="prefetch" href="../assets/js/47.9f485986.js"><link rel="prefetch" href="../assets/js/48.8f87e54d.js"><link rel="prefetch" href="../assets/js/49.03b932fc.js"><link rel="prefetch" href="../assets/js/5.a0132f30.js"><link rel="prefetch" href="../assets/js/50.6ecc158d.js"><link rel="prefetch" href="../assets/js/51.ed256bb5.js"><link rel="prefetch" href="../assets/js/52.8aa55e0d.js"><link rel="prefetch" href="../assets/js/53.b92566e2.js"><link rel="prefetch" href="../assets/js/54.aa72db74.js"><link rel="prefetch" href="../assets/js/55.43db0b13.js"><link rel="prefetch" href="../assets/js/56.99a95047.js"><link rel="prefetch" href="../assets/js/57.36019a3d.js"><link rel="prefetch" href="../assets/js/58.bbb4a297.js"><link rel="prefetch" href="../assets/js/59.83d011b0.js"><link rel="prefetch" href="../assets/js/61.f92820ad.js"><link rel="prefetch" href="../assets/js/62.ee2671f7.js"><link rel="prefetch" href="../assets/js/63.9ec4fce9.js"><link rel="prefetch" href="../assets/js/64.dde77080.js"><link rel="prefetch" href="../assets/js/65.c59bb07d.js"><link rel="prefetch" href="../assets/js/66.37172aa5.js"><link rel="prefetch" href="../assets/js/67.81b25533.js"><link rel="prefetch" href="../assets/js/68.af678c1d.js"><link rel="prefetch" href="../assets/js/7.97abf805.js"><link rel="prefetch" href="../assets/js/8.1ad597e1.js"><link rel="prefetch" href="../assets/js/9.d00e8d4e.js"><link rel="prefetch" href="../assets/js/vendors_docsearch.d31fbf91.js">
    <link rel="stylesheet" href="../assets/css/0.styles.c81fdb25.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="../index.html" class="home-link router-link-active"><!----> <span class="site-name">Discord.js Guide</span></a> <div class="links"><!----> <div class="user-settings"><a href="#" class="settings-button"><svg aria-hidden="true" data-prefix="fas" data-icon="cog" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-cog fa-w-16 settings-icon"><path fill="currentColor" d="M444.788 291.1l42.616 24.599c4.867 2.809 7.126 8.618 5.459 13.985-11.07 35.642-29.97 67.842-54.689 94.586a12.016 12.016 0 0 1-14.832 2.254l-42.584-24.595a191.577 191.577 0 0 1-60.759 35.13v49.182a12.01 12.01 0 0 1-9.377 11.718c-34.956 7.85-72.499 8.256-109.219.007-5.49-1.233-9.403-6.096-9.403-11.723v-49.184a191.555 191.555 0 0 1-60.759-35.13l-42.584 24.595a12.016 12.016 0 0 1-14.832-2.254c-24.718-26.744-43.619-58.944-54.689-94.586-1.667-5.366.592-11.175 5.459-13.985L67.212 291.1a193.48 193.48 0 0 1 0-70.199l-42.616-24.599c-4.867-2.809-7.126-8.618-5.459-13.985 11.07-35.642 29.97-67.842 54.689-94.586a12.016 12.016 0 0 1 14.832-2.254l42.584 24.595a191.577 191.577 0 0 1 60.759-35.13V25.759a12.01 12.01 0 0 1 9.377-11.718c34.956-7.85 72.499-8.256 109.219-.007 5.49 1.233 9.403 6.096 9.403 11.723v49.184a191.555 191.555 0 0 1 60.759 35.13l42.584-24.595a12.016 12.016 0 0 1 14.832 2.254c24.718 26.744 43.619 58.944 54.689 94.586 1.667 5.366-.592 11.175-5.459 13.985L444.788 220.9a193.485 193.485 0 0 1 0 70.2zM336 256c0-44.112-35.888-80-80-80s-80 35.888-80 80 35.888 80 80 80 80-35.888 80-80z"></path></svg></a> <div class="user-settings-menu" style="display:none;"><div class="theme-options"><!----> <!----> <div class="dark-theme-options toggle-option"><label for="dark-theme-toggle">Enable Dark Theme?</label> <input id="dark-theme-toggle" type="checkbox"></div> <!----> <!----></div></div></div> <!----> <form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="../index.html" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="../commando/index.html" class="nav-link">
  Commando
</a></div><div class="nav-item"><a href="https://discord.js.org/#/docs/main/stable/general/welcome" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord.js Documentation
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/discordjs/guide" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="../index.html" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="../commando/index.html" class="nav-link">
  Commando
</a></div><div class="nav-item"><a href="https://discord.js.org/#/docs/main/stable/general/welcome" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord.js Documentation
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/discordjs/guide" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Home</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../index.html" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="../requesting-more-content.html" class="sidebar-link">Requesting more content</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Installations &amp; Preparations</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../preparations/index.html" class="sidebar-link">Installing Node.js and discord.js</a></li><li><a href="../preparations/setting-up-a-linter.html" class="sidebar-link">Setting up a linter</a></li><li><a href="../preparations/setting-up-a-bot-application.html" class="sidebar-link">Setting up a bot application</a></li><li><a href="../preparations/adding-your-bot-to-servers.html" class="sidebar-link">Adding your bot to servers</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Creating Your Bot</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../creating-your-bot/index.html" class="sidebar-link">Getting your bot up &amp; running</a></li><li><a href="../creating-your-bot/configuration-files.html" class="sidebar-link">Configuration files</a></li><li><a href="../creating-your-bot/adding-more-commands.html" class="sidebar-link">Adding more commands</a></li><li><a href="../creating-your-bot/commands-with-user-input.html" class="sidebar-link">Commands with user input (a.k.a. &quot;arguments&quot;)</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Command Handler</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../command-handling/index.html" class="sidebar-link">Command handling</a></li><li><a href="../command-handling/dynamic-commands.html" class="sidebar-link">Dynamic commands</a></li><li><a href="../command-handling/adding-features.html" class="sidebar-link">Additional features</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Popular Topics</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../popular-topics/faq.html" class="sidebar-link">Frequently asked Questions</a></li><li><a href="../popular-topics/embeds.html" class="sidebar-link">Embeds</a></li><li><a href="../popular-topics/errors.html" class="sidebar-link">Errors</a></li><li><a href="../popular-topics/permissions.html" class="sidebar-link">Permissions</a></li><li><a href="../popular-topics/permissions-extended.html" class="sidebar-link">Permissions (extended)</a></li><li><a href="../popular-topics/reactions.html" class="sidebar-link">Reactions</a></li><li><a href="../popular-topics/collectors.html" class="sidebar-link">Collectors</a></li><li><a href="../popular-topics/partials.html" class="sidebar-link">Partial Structures</a></li><li><a href="../popular-topics/intents.html" class="sidebar-link">Gateway Intents</a></li><li><a href="../popular-topics/canvas.html" class="sidebar-link">Image manipulation with Canvas</a></li><li><a href="../popular-topics/webhooks.html" class="sidebar-link">Webhooks</a></li><li><a href="../popular-topics/audit-logs.html" class="sidebar-link">Working with Audit Logs</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Miscellaneous</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../miscellaneous/parsing-mention-arguments.html" class="sidebar-link">Parsing mention arguments</a></li><li><a href="../miscellaneous/useful-packages.html" class="sidebar-link">Useful packages</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Databases</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../sequelize/index.html" class="sidebar-link">Storing data with Sequelize</a></li><li><a href="../sequelize/currency.html" class="sidebar-link">Making a Currency System</a></li><li><a href="../keyv/index.html" class="sidebar-link">Storing data with Keyv</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Sharding</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="index.html" aria-current="page" class="active sidebar-link">Getting started</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="index.html#when-to-shard" class="sidebar-link">When to shard</a></li><li class="sidebar-sub-header"><a href="index.html#how-does-sharding-work" class="sidebar-link">How does sharding work?</a></li><li class="sidebar-sub-header"><a href="index.html#sharding-file" class="sidebar-link">Sharding file</a></li><li class="sidebar-sub-header"><a href="index.html#getting-started-2" class="sidebar-link">Getting started</a></li><li class="sidebar-sub-header"><a href="index.html#fetchclientvalues" class="sidebar-link">FetchClientValues</a></li><li class="sidebar-sub-header"><a href="index.html#broadcasteval" class="sidebar-link">BroadcastEval</a></li><li class="sidebar-sub-header"><a href="index.html#putting-them-together" class="sidebar-link">Putting them together</a></li><li class="sidebar-sub-header"><a href="index.html#resulting-code" class="sidebar-link">Resulting code</a></li></ul></li><li><a href="additional-information.html" class="sidebar-link">Additional information</a></li><li><a href="extended.html" class="sidebar-link">Extended changes</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>OAuth2</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../oauth2/index.html" class="sidebar-link">Getting started with OAuth2</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Voice</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../voice/index.html" class="sidebar-link">Introduction</a></li><li><a href="../voice/understanding-voice.html" class="sidebar-link">Understanding Voice</a></li><li><a href="../voice/the-basics.html" class="sidebar-link">The Basics</a></li><li><a href="../voice/voice-broadcasts.html" class="sidebar-link">Voice Broadcasts</a></li><li><a href="../voice/optimisation-and-troubleshooting.html" class="sidebar-link">Optimization and Troubleshooting</a></li><li><a href="../voice/receiving-audio.html" class="sidebar-link">Receiving Audio</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Improving Your Dev Environment</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../improving-dev-environment/pm2.html" class="sidebar-link">Managing your bot process with PM2</a></li><li><a href="../improving-dev-environment/package-json-scripts.html" class="sidebar-link">Setting up package.json scripts</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Additional Information</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../additional-info/notation.html" class="sidebar-link">Understanding notation</a></li><li><a href="../additional-info/es6-syntax.html" class="sidebar-link">ES6 syntax examples</a></li><li><a href="../additional-info/collections.html" class="sidebar-link">Collections</a></li><li><a href="../additional-info/async-await.html" class="sidebar-link">Understanding async/await</a></li><li><a href="../additional-info/rest-api.html" class="sidebar-link">Using a REST API</a></li><li><a href="../additional-info/changes-in-v12.html" class="sidebar-link">Updating from v11 to v12</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="getting-started"><a href="#getting-started" class="header-anchor">#</a> Getting started</h1> <h2 id="when-to-shard"><a href="#when-to-shard" class="header-anchor">#</a> When to shard</h2> <p>Before you dive into this section, please note that sharding may not be necessary for you. Sharding is only necessary at 2,500 guilds—at that point, Discord will not allow your bot to login without sharding. With that in mind, you should consider this when your bot is around 2,000 guilds, which should be enough time to get this working. Contrary to popular belief, sharding itself is very simple. It can be complex depending on your bot's needs, however. If your bot is in a total of 2,000 or more servers, then please continue with this guide. Otherwise, it may be a good idea to wait until then.</p> <h2 id="how-does-sharding-work"><a href="#how-does-sharding-work" class="header-anchor">#</a> How does sharding work?</h2> <p>As an application grows large, developers may find it necessary to split their process up to run parallel to one another in order to maximize efficiency. In a much larger scale of things, the developer might notice their process slow down, amongst other problems.
<a href="https://discord.com/developers/docs/topics/gateway#sharding" target="_blank" rel="noopener noreferrer">Check out the official Discord documentation on the topic.<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>This guide only explains the basics of sharding using the built-in ShardingManager, which can run shards as separate processes or threads on a single machine. If you need to scale beyond that (e.g. running shards on multiple machines/containers), you can still do it with discord.js by passing appropriate options to the Client constructor, but you will be on your own regarding managing shards and passing information between them.</p></div> <h2 id="sharding-file"><a href="#sharding-file" class="header-anchor">#</a> Sharding file</h2> <p>First, you'll need to have a file that you'll be launching from now on, rather than your original <code>index.js</code> file. It's highly recommended renaming that to <code>bot.js</code> and naming this new file to <code>index.js</code> instead. Copy &amp; paste the following snippet into your new <code>index.js</code> file.</p> <span style="display:none;"><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> ShardingManager <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'discord.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> manager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShardingManager</span><span class="token punctuation">(</span><span class="token string">'./bot.js'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> token<span class="token operator">:</span> <span class="token string">'your-token-goes-here'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

manager<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'launch'</span><span class="token punctuation">,</span> <span class="token parameter">shard</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Launched shard </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>shard<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
manager<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></span> <span style="display:block;"><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> ShardingManager <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'discord.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> manager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShardingManager</span><span class="token punctuation">(</span><span class="token string">'./bot.js'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> token<span class="token operator">:</span> <span class="token string">'your-token-goes-here'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

manager<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'shardCreate'</span><span class="token punctuation">,</span> <span class="token parameter">shard</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Launched shard </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>shard<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
manager<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></span> <p>The above code utilizes the discord.js sharding manager to spawn the recommended amount of shards for your bot. The recommended amount should be approximately 1,000 guilds per shard. Note that you have to attach the event listener to <code>shardCreate</code> before calling <code>.spawn()</code> to prevent a race condition possibly preventing shard 0 from logging the successful launch. Even though you provide the token here, you will still need to send it over to the main bot file in <code>client.login()</code>, so don't forget to do that.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>You can find the methods available for the ShardingManager class <span style="display:none;"><a href="https://discord.js.org/#/docs/main/v11/class/ShardingManager" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span><span style="display:inline-block;"><a href="https://discord.js.org/#/docs/main/stable/class/ShardingManager" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span>. Though, you may not be making much use of this section, unlike the next feature we will explore, which you may learn about by clicking <a href="additional-information.html">this link</a>.</p></div> <h2 id="getting-started-2"><a href="#getting-started-2" class="header-anchor">#</a> Getting started</h2> <p>You will most likely have to change some code in order to get your newly sharded bot to work. If your bot is very basic, then you're in luck! We assume you probably have some form of a <code>stats</code> command, by which you can quickly view your bots statistics, such as its server count. We will use it as an example that needs to be adapted to running with shards.</p> <p>In this code, you likely have the snippet <span style="display:none;"><code>client.guilds.size</code></span><span style="display:inline-block;"><code>client.guilds.cache.size</code></span>, which counts the number of <em>cached</em> guilds attached to that client. With sharding, since multiple processes will be launched, each process (each shard) will now have its own subset collection of guilds it is responsible for. This means that your original code will not function as you expect it to.</p> <p>Here is some sample code for a <code>stats</code> command, without sharding taken into consideration:</p> <span style="display:none;"><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// bot.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Client <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'discord.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> prefix <span class="token operator">=</span> <span class="token string">'!'</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token parameter">message</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>message<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span> <span class="token operator">||</span> message<span class="token punctuation">.</span>author<span class="token punctuation">.</span>bot<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

	<span class="token keyword">const</span> args <span class="token operator">=</span> message<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>prefix<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/ +/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> command <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">===</span> <span class="token string">'stats'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> message<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Server count: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>client<span class="token punctuation">.</span>guilds<span class="token punctuation">.</span>size<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token string">'your-token-goes-here'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></span> <span style="display:block;"><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// bot.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Client <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'discord.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> prefix <span class="token operator">=</span> <span class="token string">'!'</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token parameter">message</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>message<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span> <span class="token operator">||</span> message<span class="token punctuation">.</span>author<span class="token punctuation">.</span>bot<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

	<span class="token keyword">const</span> args <span class="token operator">=</span> message<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>prefix<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/ +/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> command <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">===</span> <span class="token string">'stats'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> message<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Server count: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>client<span class="token punctuation">.</span>guilds<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>size<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token string">'your-token-goes-here'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></span> <p>Let's say your bot is in a total of 3,600 guilds. Using the recommended shard count you might end up at 4 shards, each containing approximately 900 guilds. If a guild is on a certain shard (shard #2, for example) and it receives this command, the guild count will be close to 900, which is obviously not the &quot;correct&quot; number of guilds for your bot. &quot;How can I fix this?&quot;, you ask? Well, that's why we're here, isn't it?</p> <h2 id="fetchclientvalues"><a href="#fetchclientvalues" class="header-anchor">#</a> FetchClientValues</h2> <p>First, let's take a look at <span style="display:none;"><a href="https://discord.js.org/#/docs/main/v11/class/ShardClientUtil?scrollTo=fetchClientValues" target="_blank" rel="noopener noreferrer">one of the most common sharding utility methods you'll be using<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span><span style="display:inline-block;"><a href="https://discord.js.org/#/docs/main/stable/class/ShardClientUtil?scrollTo=fetchClientValues" target="_blank" rel="noopener noreferrer">one of the most common sharding utility methods you'll be using<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span> called <code>fetchClientValues</code>. This method retrieves a property on the Client object of all shards.</p> <p>Now, take the following snippet of code:</p> <span style="display:none;"><div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span>shard<span class="token punctuation">.</span><span class="token function">fetchClientValues</span><span class="token punctuation">(</span><span class="token string">'guilds.size'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></span> <span style="display:block;"><div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span>shard<span class="token punctuation">.</span><span class="token function">fetchClientValues</span><span class="token punctuation">(</span><span class="token string">'guilds.cache.size'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></span> <p>If you run it, you will notice an output like <code>[898, 901, 900, 901]</code>. You will be correct in assuming that that's the total number of guilds per shard, which is stored in an array in the Promise. This probably isn't the ideal output for guild count, so we will need to make use of an array manipulation method, specifically <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce" target="_blank" rel="noopener noreferrer">Array.reduce()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>It's highly recommended for you to visit <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce" target="_blank" rel="noopener noreferrer">the documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to understand how the <code>reduce()</code> method works, as you will probably find great use of it in sharding.</p></div> <p>In this case, this method iterates through the array and adds each current value to the total amount:</p> <span style="display:none;"><div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span>shard<span class="token punctuation">.</span><span class="token function">fetchClientValues</span><span class="token punctuation">(</span><span class="token string">'guilds.size'</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">results</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>results<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> guildCount</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> acc <span class="token operator">+</span> guildCount<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> total guilds</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></span> <span style="display:block;"><div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span>shard<span class="token punctuation">.</span><span class="token function">fetchClientValues</span><span class="token punctuation">(</span><span class="token string">'guilds.cache.size'</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">results</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>results<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> guildCount</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> acc <span class="token operator">+</span> guildCount<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> total guilds</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></span> <p>While it's a bit unattractive to have more nesting in your commands, it is necessary when not using <code>async</code>/<code>await</code>. Now, the code at the top should look something like the below:</p> <span style="display:none;"><div class="language-diff extra-class"><pre class="language-diff"><code>	if (command === 'stats') {
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">		return message.channel.send(`Server count: ${client.guilds.size}`);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">		return client.shard.fetchClientValues('guilds.size')
</span><span class="token prefix inserted">+</span><span class="token line">			.then(results =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">				return message.channel.send(`Server count: ${results.reduce((acc, guildCount) =&gt; acc + guildCount, 0)}`);
</span><span class="token prefix inserted">+</span><span class="token line">			})
</span><span class="token prefix inserted">+</span><span class="token line">			.catch(console.error);
</span></span>	}
</code></pre></div></span> <span style="display:block;"><div class="language-diff extra-class"><pre class="language-diff"><code>	if (command === 'stats') {
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">		return message.channel.send(`Server count: ${client.guilds.cache.size}`);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">		return client.shard.fetchClientValues('guilds.cache.size')
</span><span class="token prefix inserted">+</span><span class="token line">			.then(results =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">				return message.channel.send(`Server count: ${results.reduce((acc, guildCount) =&gt; acc + guildCount, 0)}`);
</span><span class="token prefix inserted">+</span><span class="token line">			})
</span><span class="token prefix inserted">+</span><span class="token line">			.catch(console.error);
</span></span>	}
</code></pre></div></span> <h2 id="broadcasteval"><a href="#broadcasteval" class="header-anchor">#</a> BroadcastEval</h2> <p>Next, check out <span style="display:none;"><a href="https://discord.js.org/#/docs/main/v11/class/ShardClientUtil?scrollTo=broadcastEval" target="_blank" rel="noopener noreferrer">another handy sharding method<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span><span style="display:inline-block;"><a href="https://discord.js.org/#/docs/main/stable/class/ShardClientUtil?scrollTo=broadcastEval" target="_blank" rel="noopener noreferrer">another handy sharding method<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span> known as <code>broadcastEval</code>. This method makes all of the shards evaluate a given script, where <code>this</code> is the <code>client</code> once each shard gets to evaluating it. You can read more about the <code>this</code> keyword <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/this" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. For now, essentially understand that it is the shard's Client object.</p> <span style="display:none;"><div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span>shard<span class="token punctuation">.</span><span class="token function">broadcastEval</span><span class="token punctuation">(</span><span class="token string">'this.guilds.reduce((acc, guild) =&gt; acc + guild.memberCount, 0)'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></span> <span style="display:block;"><div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span>shard<span class="token punctuation">.</span><span class="token function">broadcastEval</span><span class="token punctuation">(</span><span class="token string">'this.guilds.cache.reduce((acc, guild) =&gt; acc + guild.memberCount, 0)'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></span> <p>This will run the code given to <code>broadcastEval</code> on each shard and return the results to the Promise as an array, once again. You should see something like <code>[9001, 16658, 13337, 15687]</code> logged. The code being sent to each shard adds up the <code>memberCount</code> property of every guild that shard is handling and returns it, so it's each shard's total guild member count. Of course, if you want to then total up the member count of <em>every</em> shard, you can do the same thing again on the results returned from the Promise.</p> <span style="display:none;"><div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span>shard<span class="token punctuation">.</span><span class="token function">broadcastEval</span><span class="token punctuation">(</span><span class="token string">'this.guilds.reduce((acc, guild) =&gt; acc + guild.memberCount, 0)'</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">results</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> message<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Total member count: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>results<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> memberCount</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> acc <span class="token operator">+</span> memberCount<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></span> <span style="display:block;"><div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span>shard<span class="token punctuation">.</span><span class="token function">broadcastEval</span><span class="token punctuation">(</span><span class="token string">'this.guilds.cache.reduce((acc, guild) =&gt; acc + guild.memberCount, 0)'</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">results</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> message<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Total member count: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>results<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> memberCount</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> acc <span class="token operator">+</span> memberCount<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></span> <h2 id="putting-them-together"><a href="#putting-them-together" class="header-anchor">#</a> Putting them together</h2> <p>You'd likely want to output both pieces of information in the stats command, so let's combine these two examples using <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/all" target="_blank" rel="noopener noreferrer">Promise.all()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:</p> <span style="display:none;"><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span>
	client<span class="token punctuation">.</span>shard<span class="token punctuation">.</span><span class="token function">fetchClientValues</span><span class="token punctuation">(</span><span class="token string">'guilds.size'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	client<span class="token punctuation">.</span>shard<span class="token punctuation">.</span><span class="token function">broadcastEval</span><span class="token punctuation">(</span><span class="token string">'this.guilds.reduce((acc, guild) =&gt; acc + guild.memberCount, 0)'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">results</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> totalGuilds <span class="token operator">=</span> results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> guildCount</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> acc <span class="token operator">+</span> guildCount<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> totalMembers <span class="token operator">=</span> results<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> memberCount</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> acc <span class="token operator">+</span> memberCount<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> message<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Server count: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>totalGuilds<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\nMember count: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>totalMembers<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></span> <span style="display:block;"><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span>
	client<span class="token punctuation">.</span>shard<span class="token punctuation">.</span><span class="token function">fetchClientValues</span><span class="token punctuation">(</span><span class="token string">'guilds.cache.size'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	client<span class="token punctuation">.</span>shard<span class="token punctuation">.</span><span class="token function">broadcastEval</span><span class="token punctuation">(</span><span class="token string">'this.guilds.cache.reduce((acc, guild) =&gt; acc + guild.memberCount, 0)'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">results</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> totalGuilds <span class="token operator">=</span> results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> guildCount</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> acc <span class="token operator">+</span> guildCount<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> totalMembers <span class="token operator">=</span> results<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> memberCount</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> acc <span class="token operator">+</span> memberCount<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> message<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Server count: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>totalGuilds<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\nMember count: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>totalMembers<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></span> <p><code>Promise.all()</code> runs every promise you pass to it inside of an array in parallel, and waits for them all to finish before returning all of their results at once. The result is an array that corresponds with the array of promises you pass - so the first result element will be from the first promise. With that, your stats command should look something like this:</p> <span style="display:none;"><div class="language-diff extra-class"><pre class="language-diff"><code>	if (command === 'stats') {
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">		return message.channel.send(`Server count: ${client.guilds.size}`);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">		const promises = [
</span><span class="token prefix inserted">+</span><span class="token line">			client.shard.fetchClientValues('guilds.size'),
</span><span class="token prefix inserted">+</span><span class="token line">			client.shard.broadcastEval('this.guilds.reduce((acc, guild) =&gt; acc + guild.memberCount, 0)')
</span><span class="token prefix inserted">+</span><span class="token line">		];
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">		return Promise.all(promises)
</span><span class="token prefix inserted">+</span><span class="token line">			.then(results =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">				const totalGuilds = results[0].reduce((acc, guildCount) =&gt; acc + guildCount, 0);
</span><span class="token prefix inserted">+</span><span class="token line">				const totalMembers = results[1].reduce((acc, memberCount) =&gt; acc + memberCount, 0);
</span><span class="token prefix inserted">+</span><span class="token line">				return message.channel.send(`Server count: ${totalGuilds}\nMember count: ${totalMembers}`);
</span><span class="token prefix inserted">+</span><span class="token line">			})
</span><span class="token prefix inserted">+</span><span class="token line">			.catch(console.error);
</span></span>	}
</code></pre></div></span> <span style="display:block;"><div class="language-diff extra-class"><pre class="language-diff"><code>	if (command === 'stats') {
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">		return message.channel.send(`Server count: ${client.guilds.cache.size}`);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">		const promises = [
</span><span class="token prefix inserted">+</span><span class="token line">			client.shard.fetchClientValues('guilds.cache.size'),
</span><span class="token prefix inserted">+</span><span class="token line">			client.shard.broadcastEval('this.guilds.cache.reduce((acc, guild) =&gt; acc + guild.memberCount, 0)')
</span><span class="token prefix inserted">+</span><span class="token line">		];
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">		return Promise.all(promises)
</span><span class="token prefix inserted">+</span><span class="token line">			.then(results =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">				const totalGuilds = results[0].reduce((acc, guildCount) =&gt; acc + guildCount, 0);
</span><span class="token prefix inserted">+</span><span class="token line">				const totalMembers = results[1].reduce((acc, memberCount) =&gt; acc + memberCount, 0);
</span><span class="token prefix inserted">+</span><span class="token line">				return message.channel.send(`Server count: ${totalGuilds}\nMember count: ${totalMembers}`);
</span><span class="token prefix inserted">+</span><span class="token line">			})
</span><span class="token prefix inserted">+</span><span class="token line">			.catch(console.error);
</span></span>	}
</code></pre></div></span> <p>The next section contains additional changes you might want to take into consideration, which you may learn about by clicking <a href="additional-information.html">this link</a>.</p> <h2 id="resulting-code"><a href="#resulting-code" class="header-anchor">#</a> Resulting code</h2> <p>
	If you want to compare your code to the code we've constructed so far, you can review it over on the GitHub repository
	<a href="https://github.com/discordjs/guide/tree/master/code-samples/" target="_blank" rel="noopener noreferrer">
		here <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.
</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/discordjs/guide/edit/master/guide/sharding/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/3/2020, 8:16:36 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="../keyv/index.html" class="prev">
        Storing data with Keyv
      </a></span> <span class="next"><a href="additional-information.html">
        Additional information
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="../assets/js/app.1b16820c.js" defer></script><script src="../assets/js/4.58143105.js" defer></script><script src="../assets/js/60.8138be15.js" defer></script><script src="../assets/js/16.e90c1593.js" defer></script><script src="../assets/js/22.549d06f2.js" defer></script><script src="../assets/js/6.1ed8886a.js" defer></script>
  </body>

<!-- Mirrored from discordjs.guide/sharding/ by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 17 Jan 2021 09:05:05 GMT -->
</html>

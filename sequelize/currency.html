<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from discordjs.guide/sequelize/currency.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 17 Jan 2021 09:05:05 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Making a Currency System | Discord.js Guide</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="../favicon.png">
    <meta name="description" content="A guide made by the community of discord.js for its users.">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#42b983">
    <meta name="twitter:card" content="summary">
    <meta name="og:title" content="Discord.js Guide">
    <meta name="og:description" content="A guide made by the community of discord.js for its users.">
    <meta name="og:type" content="website">
    <meta name="og:url" content="../index.html">
    <meta name="og:locale" content="en_US">
    <meta name="og:image" content="../meta-image.png">
    <link rel="preload" href="../assets/css/0.styles.c81fdb25.css" as="style"><link rel="preload" href="../assets/js/app.1b16820c.js" as="script"><link rel="preload" href="../assets/js/4.58143105.js" as="script"><link rel="preload" href="../assets/js/21.c20bf682.js" as="script"><link rel="preload" href="../assets/js/16.e90c1593.js" as="script"><link rel="preload" href="../assets/js/22.549d06f2.js" as="script"><link rel="preload" href="../assets/js/6.1ed8886a.js" as="script"><link rel="prefetch" href="../assets/js/1.4966f13b.js"><link rel="prefetch" href="../assets/js/10.d9e5e65a.js"><link rel="prefetch" href="../assets/js/11.4d024292.js"><link rel="prefetch" href="../assets/js/12.0ebfb6b5.js"><link rel="prefetch" href="../assets/js/13.ec6ebc85.js"><link rel="prefetch" href="../assets/js/14.e0c1c3e6.js"><link rel="prefetch" href="../assets/js/15.468032d7.js"><link rel="prefetch" href="../assets/js/17.48dc860b.js"><link rel="prefetch" href="../assets/js/18.66fb5b1b.js"><link rel="prefetch" href="../assets/js/19.267ae342.js"><link rel="prefetch" href="../assets/js/20.c083e492.js"><link rel="prefetch" href="../assets/js/23.97219136.js"><link rel="prefetch" href="../assets/js/24.597d3784.js"><link rel="prefetch" href="../assets/js/25.e66ea496.js"><link rel="prefetch" href="../assets/js/26.3e94b2e9.js"><link rel="prefetch" href="../assets/js/27.c1f13a28.js"><link rel="prefetch" href="../assets/js/28.7159a662.js"><link rel="prefetch" href="../assets/js/29.d4774ef2.js"><link rel="prefetch" href="../assets/js/30.90995d89.js"><link rel="prefetch" href="../assets/js/31.de2dcdf7.js"><link rel="prefetch" href="../assets/js/32.a19a8a69.js"><link rel="prefetch" href="../assets/js/33.d3547ea6.js"><link rel="prefetch" href="../assets/js/34.999b3eb5.js"><link rel="prefetch" href="../assets/js/35.8165c07f.js"><link rel="prefetch" href="../assets/js/36.2b277f69.js"><link rel="prefetch" href="../assets/js/37.3ea48fb0.js"><link rel="prefetch" href="../assets/js/38.c2159f22.js"><link rel="prefetch" href="../assets/js/39.50884a19.js"><link rel="prefetch" href="../assets/js/40.a8990f37.js"><link rel="prefetch" href="../assets/js/41.701c8a9b.js"><link rel="prefetch" href="../assets/js/42.b84d3fd9.js"><link rel="prefetch" href="../assets/js/43.5faf8a11.js"><link rel="prefetch" href="../assets/js/44.13615e3c.js"><link rel="prefetch" href="../assets/js/45.487383a0.js"><link rel="prefetch" href="../assets/js/46.9ed01b37.js"><link rel="prefetch" href="../assets/js/47.9f485986.js"><link rel="prefetch" href="../assets/js/48.8f87e54d.js"><link rel="prefetch" href="../assets/js/49.03b932fc.js"><link rel="prefetch" href="../assets/js/5.a0132f30.js"><link rel="prefetch" href="../assets/js/50.6ecc158d.js"><link rel="prefetch" href="../assets/js/51.ed256bb5.js"><link rel="prefetch" href="../assets/js/52.8aa55e0d.js"><link rel="prefetch" href="../assets/js/53.b92566e2.js"><link rel="prefetch" href="../assets/js/54.aa72db74.js"><link rel="prefetch" href="../assets/js/55.43db0b13.js"><link rel="prefetch" href="../assets/js/56.99a95047.js"><link rel="prefetch" href="../assets/js/57.36019a3d.js"><link rel="prefetch" href="../assets/js/58.bbb4a297.js"><link rel="prefetch" href="../assets/js/59.83d011b0.js"><link rel="prefetch" href="../assets/js/60.8138be15.js"><link rel="prefetch" href="../assets/js/61.f92820ad.js"><link rel="prefetch" href="../assets/js/62.ee2671f7.js"><link rel="prefetch" href="../assets/js/63.9ec4fce9.js"><link rel="prefetch" href="../assets/js/64.dde77080.js"><link rel="prefetch" href="../assets/js/65.c59bb07d.js"><link rel="prefetch" href="../assets/js/66.37172aa5.js"><link rel="prefetch" href="../assets/js/67.81b25533.js"><link rel="prefetch" href="../assets/js/68.af678c1d.js"><link rel="prefetch" href="../assets/js/7.97abf805.js"><link rel="prefetch" href="../assets/js/8.1ad597e1.js"><link rel="prefetch" href="../assets/js/9.d00e8d4e.js"><link rel="prefetch" href="../assets/js/vendors_docsearch.d31fbf91.js">
    <link rel="stylesheet" href="../assets/css/0.styles.c81fdb25.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="../index.html" class="home-link router-link-active"><!----> <span class="site-name">Discord.js Guide</span></a> <div class="links"><!----> <div class="user-settings"><a href="#" class="settings-button"><svg aria-hidden="true" data-prefix="fas" data-icon="cog" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-cog fa-w-16 settings-icon"><path fill="currentColor" d="M444.788 291.1l42.616 24.599c4.867 2.809 7.126 8.618 5.459 13.985-11.07 35.642-29.97 67.842-54.689 94.586a12.016 12.016 0 0 1-14.832 2.254l-42.584-24.595a191.577 191.577 0 0 1-60.759 35.13v49.182a12.01 12.01 0 0 1-9.377 11.718c-34.956 7.85-72.499 8.256-109.219.007-5.49-1.233-9.403-6.096-9.403-11.723v-49.184a191.555 191.555 0 0 1-60.759-35.13l-42.584 24.595a12.016 12.016 0 0 1-14.832-2.254c-24.718-26.744-43.619-58.944-54.689-94.586-1.667-5.366.592-11.175 5.459-13.985L67.212 291.1a193.48 193.48 0 0 1 0-70.199l-42.616-24.599c-4.867-2.809-7.126-8.618-5.459-13.985 11.07-35.642 29.97-67.842 54.689-94.586a12.016 12.016 0 0 1 14.832-2.254l42.584 24.595a191.577 191.577 0 0 1 60.759-35.13V25.759a12.01 12.01 0 0 1 9.377-11.718c34.956-7.85 72.499-8.256 109.219-.007 5.49 1.233 9.403 6.096 9.403 11.723v49.184a191.555 191.555 0 0 1 60.759 35.13l42.584-24.595a12.016 12.016 0 0 1 14.832 2.254c24.718 26.744 43.619 58.944 54.689 94.586 1.667 5.366-.592 11.175-5.459 13.985L444.788 220.9a193.485 193.485 0 0 1 0 70.2zM336 256c0-44.112-35.888-80-80-80s-80 35.888-80 80 35.888 80 80 80 80-35.888 80-80z"></path></svg></a> <div class="user-settings-menu" style="display:none;"><div class="theme-options"><!----> <!----> <div class="dark-theme-options toggle-option"><label for="dark-theme-toggle">Enable Dark Theme?</label> <input id="dark-theme-toggle" type="checkbox"></div> <!----> <!----></div></div></div> <!----> <form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="../index.html" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="../commando/index.html" class="nav-link">
  Commando
</a></div><div class="nav-item"><a href="https://discord.js.org/#/docs/main/stable/general/welcome" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord.js Documentation
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/discordjs/guide" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="../index.html" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="../commando/index.html" class="nav-link">
  Commando
</a></div><div class="nav-item"><a href="https://discord.js.org/#/docs/main/stable/general/welcome" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord.js Documentation
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/discordjs/guide" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Home</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../index.html" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="../requesting-more-content.html" class="sidebar-link">Requesting more content</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Installations &amp; Preparations</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../preparations/index.html" class="sidebar-link">Installing Node.js and discord.js</a></li><li><a href="../preparations/setting-up-a-linter.html" class="sidebar-link">Setting up a linter</a></li><li><a href="../preparations/setting-up-a-bot-application.html" class="sidebar-link">Setting up a bot application</a></li><li><a href="../preparations/adding-your-bot-to-servers.html" class="sidebar-link">Adding your bot to servers</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Creating Your Bot</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../creating-your-bot/index.html" class="sidebar-link">Getting your bot up &amp; running</a></li><li><a href="../creating-your-bot/configuration-files.html" class="sidebar-link">Configuration files</a></li><li><a href="../creating-your-bot/adding-more-commands.html" class="sidebar-link">Adding more commands</a></li><li><a href="../creating-your-bot/commands-with-user-input.html" class="sidebar-link">Commands with user input (a.k.a. &quot;arguments&quot;)</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Command Handler</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../command-handling/index.html" class="sidebar-link">Command handling</a></li><li><a href="../command-handling/dynamic-commands.html" class="sidebar-link">Dynamic commands</a></li><li><a href="../command-handling/adding-features.html" class="sidebar-link">Additional features</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Popular Topics</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../popular-topics/faq.html" class="sidebar-link">Frequently asked Questions</a></li><li><a href="../popular-topics/embeds.html" class="sidebar-link">Embeds</a></li><li><a href="../popular-topics/errors.html" class="sidebar-link">Errors</a></li><li><a href="../popular-topics/permissions.html" class="sidebar-link">Permissions</a></li><li><a href="../popular-topics/permissions-extended.html" class="sidebar-link">Permissions (extended)</a></li><li><a href="../popular-topics/reactions.html" class="sidebar-link">Reactions</a></li><li><a href="../popular-topics/collectors.html" class="sidebar-link">Collectors</a></li><li><a href="../popular-topics/partials.html" class="sidebar-link">Partial Structures</a></li><li><a href="../popular-topics/intents.html" class="sidebar-link">Gateway Intents</a></li><li><a href="../popular-topics/canvas.html" class="sidebar-link">Image manipulation with Canvas</a></li><li><a href="../popular-topics/webhooks.html" class="sidebar-link">Webhooks</a></li><li><a href="../popular-topics/audit-logs.html" class="sidebar-link">Working with Audit Logs</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Miscellaneous</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../miscellaneous/parsing-mention-arguments.html" class="sidebar-link">Parsing mention arguments</a></li><li><a href="../miscellaneous/useful-packages.html" class="sidebar-link">Useful packages</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Databases</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="index.html" aria-current="page" class="sidebar-link">Storing data with Sequelize</a></li><li><a href="currency.html" aria-current="page" class="active sidebar-link">Making a Currency System</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="currency.html#file-overview" class="sidebar-link">File overview</a></li><li class="sidebar-sub-header"><a href="currency.html#create-models" class="sidebar-link">Create models</a></li><li class="sidebar-sub-header"><a href="currency.html#initialize-database" class="sidebar-link">Initialize database</a></li><li class="sidebar-sub-header"><a href="currency.html#create-associations" class="sidebar-link">Create associations</a></li><li class="sidebar-sub-header"><a href="currency.html#application-code" class="sidebar-link">Application code</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="currency.html#alpha-helper-methods" class="sidebar-link">[alpha] Helper methods</a></li><li class="sidebar-sub-header"><a href="currency.html#beta-ready-event-data-sync" class="sidebar-link">[beta] Ready event data sync</a></li><li class="sidebar-sub-header"><a href="currency.html#gamma-show-user-balance" class="sidebar-link">[gamma] Show user balance</a></li><li class="sidebar-sub-header"><a href="currency.html#delta-show-user-inventory" class="sidebar-link">[delta] Show user inventory</a></li><li class="sidebar-sub-header"><a href="currency.html#epsilon-transfer-currency-to-another-user" class="sidebar-link">[epsilon] Transfer currency to another user</a></li><li class="sidebar-sub-header"><a href="currency.html#zeta-buying-an-item" class="sidebar-link">[zeta] Buying an item</a></li><li class="sidebar-sub-header"><a href="currency.html#theta-display-the-shop" class="sidebar-link">[theta] Display the shop</a></li><li class="sidebar-sub-header"><a href="currency.html#lambda-display-the-leaderboard" class="sidebar-link">[lambda] Display the leaderboard</a></li></ul></li><li class="sidebar-sub-header"><a href="currency.html#resulting-code" class="sidebar-link">Resulting code</a></li></ul></li><li><a href="../keyv/index.html" class="sidebar-link">Storing data with Keyv</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Sharding</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../sharding/index.html" class="sidebar-link">Getting started</a></li><li><a href="../sharding/additional-information.html" class="sidebar-link">Additional information</a></li><li><a href="../sharding/extended.html" class="sidebar-link">Extended changes</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>OAuth2</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../oauth2/index.html" class="sidebar-link">Getting started with OAuth2</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Voice</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../voice/index.html" class="sidebar-link">Introduction</a></li><li><a href="../voice/understanding-voice.html" class="sidebar-link">Understanding Voice</a></li><li><a href="../voice/the-basics.html" class="sidebar-link">The Basics</a></li><li><a href="../voice/voice-broadcasts.html" class="sidebar-link">Voice Broadcasts</a></li><li><a href="../voice/optimisation-and-troubleshooting.html" class="sidebar-link">Optimization and Troubleshooting</a></li><li><a href="../voice/receiving-audio.html" class="sidebar-link">Receiving Audio</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Improving Your Dev Environment</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../improving-dev-environment/pm2.html" class="sidebar-link">Managing your bot process with PM2</a></li><li><a href="../improving-dev-environment/package-json-scripts.html" class="sidebar-link">Setting up package.json scripts</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Additional Information</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../additional-info/notation.html" class="sidebar-link">Understanding notation</a></li><li><a href="../additional-info/es6-syntax.html" class="sidebar-link">ES6 syntax examples</a></li><li><a href="../additional-info/collections.html" class="sidebar-link">Collections</a></li><li><a href="../additional-info/async-await.html" class="sidebar-link">Understanding async/await</a></li><li><a href="../additional-info/rest-api.html" class="sidebar-link">Using a REST API</a></li><li><a href="../additional-info/changes-in-v12.html" class="sidebar-link">Updating from v11 to v12</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="making-a-currency-system"><a href="#making-a-currency-system" class="header-anchor">#</a> Making a Currency System</h1> <p>A common feature of Discord bots is a currency system. It's possible to do everything in one object, but we can also abstract that in terms of <em>relations</em> between objects. This is where the power of a RDBMS (Relational Database Management System) truly shines. Sequelize calls these <em>associations</em>, so we'll be using that term from now on.</p> <h2 id="file-overview"><a href="#file-overview" class="header-anchor">#</a> File overview</h2> <p>There will be multiple files: a DB init script, your models, and your bot script. In the previous tutorial, we placed all of these in the same file. Having everything in one file is usually not how it's done in the real world, so we'll correct that.</p> <p>This time we'll have 6 files.</p> <ul><li><code>app.js</code> is where we'll keep the main bot code.</li> <li><code>dbInit.js</code> is the initialization file for the database. We run this once and forget about it.</li> <li><code>dbObjects.js</code> is where we'll import the models and create associations here.</li> <li><code>models/Users.js</code> is the Users model. Users will have a currency attribute in here.</li> <li><code>models/CurrencyShop.js</code> is the Shop model. The shop will have a name and a price for each item.</li> <li><code>models/UserItems.js</code> is the junction table between the users and the shop. A junction table is used to connect two tables together. Our junction table will have an additional field for the amount of that item the user has.</li></ul> <h2 id="create-models"><a href="#create-models" class="header-anchor">#</a> Create models</h2> <p>Here is an entity relation diagram of the models we'll be making:</p> <img src="../assets/img/currency_er_diagram.585069bc.svg" alt="Currency database structure diagram"> <p><code>Users</code> have a <code>user_id</code>, and a <code>balance</code>. Each <code>user_id</code> can have multiple links to the <code>UserItems</code> table, and each entry in the table is connected to one of the items in the <code>CurrencyShop</code>, which will have a <code>name</code> and a <code>cost</code> associated with it.</p> <p>To implement this, we'll begin by making a <code>models</code> folder and create a <code>Users.js</code> file inside which contains the following:</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
		user_id<span class="token operator">:</span> <span class="token punctuation">{</span>
			type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
			primaryKey<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		balance<span class="token operator">:</span> <span class="token punctuation">{</span>
			type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
			defaultValue<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
			allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
		timestamps<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Like you see in the diagram above, our Users model will only have 2 attributes: a <code>user_id</code> primary key and a <code>balance</code>. A primary key is a special type of attribute that becomes the default column used when joining tables together. In addition, a primary key is automatically set as unique and not null.</p> <p>Balance also sets <code>allowNull</code> to <code>false</code>. This, in conjunction with setting a primary key, means that both values have to be set, otherwise the database would throw an error. This means that we guarantee correctness in our data storage in that we never have null or empty values. This ensures that if we somehow forget to validate in the application that both values are not null, our database would do the final validation for us.</p> <p>Notice that our options object sets <code>timestamps</code> to <code>false</code>. This disables the <code>createdAt</code> and the <code>updatedAt</code> columns that sequelize usually creates for you. Setting <code>user_id</code> to primary also gets rid of the <code>id</code> primary key that Sequelize usually generates for you, since there can only be one primary key on a table.</p> <p>Next, still in the same <code>models</code> folder, create a <code>CurrencyShop.js</code> file that contains the following:</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'currency_shop'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
		name<span class="token operator">:</span> <span class="token punctuation">{</span>
			type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
			unique<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		cost<span class="token operator">:</span> <span class="token punctuation">{</span>
			type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
			allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
		timestamps<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Like our Users model, we don't need the timestamps here, so we'll disable it. Unlike the Users model however, we only set <code>unique</code> to <code>true</code> here. This is so that if you want to change the name of the item, you can change the name without affecting the primary key that joins this to the next object. This gets generated automatically by sequelize since we didn't set a primary key.</p> <p>The next file will be <code>UserItems.js</code>, our junction table.</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'user_item'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
		user_id<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
		item_id<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
		amount<span class="token operator">:</span> <span class="token punctuation">{</span>
			type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
			allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
			<span class="token string">'default'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
		timestamps<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Our junction table will link <code>user_id</code> and the <code>id</code> of the currency shop together. It also contains an <code>amount</code> number which indicates how many of that item a user has.</p> <h2 id="initialize-database"><a href="#initialize-database" class="header-anchor">#</a> Initialize database</h2> <p>Now that the models are defined, we should create them in our database so that we can access them in the bot file. We ran the sync in the <code>ready</code> event in our bot in the previous tutorial, which is completely unnecessary, since it only needs to run once. So what we can do is make a file to initialize the database and never touch it again unless we want to remake the entire database.</p> <p>Create a file called <code>dbInit.js</code> in the base directory (<em>not</em> in the <code>models</code> folder).</p> <div class="custom-block danger"><p class="custom-block-title">WARNING</p> <p>Make sure you use version 5 or later of Sequelize! Version 4 as used in this guide will pose a security threat. You can read more about this issue on the <a href="https://github.com/sequelize/sequelize/issues/7310" target="_blank" rel="noopener noreferrer">Sequelize issue tracker<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Sequelize <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sequelize'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> sequelize <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sequelize</span><span class="token punctuation">(</span><span class="token string">'database'</span><span class="token punctuation">,</span> <span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'password'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	host<span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
	dialect<span class="token operator">:</span> <span class="token string">'sqlite'</span><span class="token punctuation">,</span>
	logging<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
	storage<span class="token operator">:</span> <span class="token string">'database.sqlite'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> CurrencyShop <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./models/CurrencyShop'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>sequelize<span class="token punctuation">,</span> Sequelize<span class="token punctuation">.</span>DataTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./models/Users'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>sequelize<span class="token punctuation">,</span> Sequelize<span class="token punctuation">.</span>DataTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./models/UserItems'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>sequelize<span class="token punctuation">,</span> Sequelize<span class="token punctuation">.</span>DataTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> force <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'--force'</span><span class="token punctuation">)</span> <span class="token operator">||</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'-f'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

sequelize<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">{</span> force <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> shop <span class="token operator">=</span> <span class="token punctuation">[</span>
		CurrencyShop<span class="token punctuation">.</span><span class="token function">upsert</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Tea'</span><span class="token punctuation">,</span> cost<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		CurrencyShop<span class="token punctuation">.</span><span class="token function">upsert</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Coffee'</span><span class="token punctuation">,</span> cost<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		CurrencyShop<span class="token punctuation">.</span><span class="token function">upsert</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Cake'</span><span class="token punctuation">,</span> cost<span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>shop<span class="token punctuation">)</span><span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Database synced'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Here we pull the two models and the junction table from the respective model declarations, sync them, and add items to our shop.</p> <p>A new function here is the <code>.upsert()</code> function. It's a portmanteau for <strong>up</strong>date or in<strong>sert</strong>.  We use <code>upsert</code> here because just in case you run this file multiple times, it doesn't create duplicates. That shouldn't happen because we defined name as <em>unique</em> but there's no harm in being safe. Upsert also has a nice side benefit; If you adjust the cost, the respective item should also have their cost updated.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Execute <code>node dbInit.js</code> to create the database tables. Unless you make a change to the models, you'll never need to touch the file again. If you do make a change to a model, you can execute <code>node dbInit.js --force</code> or <code>node dbInit.js -f</code> to force sync your tables. It's important to note that this <strong>will</strong> empty out and remake your model tables.</p></div> <h2 id="create-associations"><a href="#create-associations" class="header-anchor">#</a> Create associations</h2> <p>Next we'll add our associations to the models. Create a file named <code>dbObjects.js</code> in the base directory, next to <code>dbInit.js</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Sequelize <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sequelize'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> sequelize <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sequelize</span><span class="token punctuation">(</span><span class="token string">'database'</span><span class="token punctuation">,</span> <span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'password'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	host<span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
	dialect<span class="token operator">:</span> <span class="token string">'sqlite'</span><span class="token punctuation">,</span>
	logging<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
	storage<span class="token operator">:</span> <span class="token string">'database.sqlite'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Users <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./models/Users'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>sequelize<span class="token punctuation">,</span> Sequelize<span class="token punctuation">.</span>DataTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> CurrencyShop <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./models/CurrencyShop'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>sequelize<span class="token punctuation">,</span> Sequelize<span class="token punctuation">.</span>DataTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> UserItems <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./models/UserItems'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>sequelize<span class="token punctuation">,</span> Sequelize<span class="token punctuation">.</span>DataTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>

UserItems<span class="token punctuation">.</span><span class="token function">belongsTo</span><span class="token punctuation">(</span>CurrencyShop<span class="token punctuation">,</span> <span class="token punctuation">{</span> foreignKey<span class="token operator">:</span> <span class="token string">'item_id'</span><span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token operator">:</span> <span class="token string">'item'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* eslint-disable-next-line func-names */</span>
<span class="token class-name">Users</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">addItem</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> userItem <span class="token operator">=</span> <span class="token keyword">await</span> UserItems<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		where<span class="token operator">:</span> <span class="token punctuation">{</span> user_id<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>user_id<span class="token punctuation">,</span> item_id<span class="token operator">:</span> item<span class="token punctuation">.</span>id <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>userItem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		userItem<span class="token punctuation">.</span>amount <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> userItem<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> UserItems<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user_id<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>user_id<span class="token punctuation">,</span> item_id<span class="token operator">:</span> item<span class="token punctuation">.</span>id<span class="token punctuation">,</span> amount<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/* eslint-disable-next-line func-names */</span>
<span class="token class-name">Users</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getItems</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> UserItems<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		where<span class="token operator">:</span> <span class="token punctuation">{</span> user_id<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>user_id <span class="token punctuation">}</span><span class="token punctuation">,</span>
		include<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'item'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> Users<span class="token punctuation">,</span> CurrencyShop<span class="token punctuation">,</span> UserItems <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Note that we could have abstracted the connection object in another file, and had both <code>dbInit.js</code> and <code>dbObjects.js</code> use that connection file, but it's not necessary to overly abstract things.</p> <p>The new method we haven't seen yet is the <code>.belongsTo()</code> method. Using this method, we add <code>CurrencyShop</code> as a property of <code>UserItem</code> so that when we do <code>userItem.item</code> we get the respective item that it's attached to. We use <code>item_id</code> as the foreign key so that it knows which item to attach.</p> <p>We now add some prototypes to the User object to finish up the junction: add items to users, and get their current inventory. The code inside should be somewhat familiar from the last tutorial. We use a <code>.findOne()</code> to get the item if it exists in the user's inventory. We increment if it does, or create it if it doesn't.</p> <p>Getting items is similar, we just <code>.findAll()</code> using the user's id as the key. The <code>include</code> key is for associating the CurrencyShop with the item. We basically have to explicitly tell Sequelize to honor the <code>.belongsTo()</code> association, otherwise it will take the path of least effort.</p> <h2 id="application-code"><a href="#application-code" class="header-anchor">#</a> Application code</h2> <p>To put it together, we'll create an <code>app.js</code> in the base directory with the following skeleton code.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Discord <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'discord.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Discord<span class="token punctuation">.</span>Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Users<span class="token punctuation">,</span> CurrencyShop <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./dbObjects'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Op <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sequelize'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> currency <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Discord<span class="token punctuation">.</span>Collection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">PREFIX</span> <span class="token operator">=</span> <span class="token string">'!'</span><span class="token punctuation">;</span>

<span class="token comment">// [alpha]</span>

client<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">'ready'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">// [beta]</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Logged in as </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>client<span class="token punctuation">.</span>user<span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">message</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span>author<span class="token punctuation">.</span>bot<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
	currency<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>author<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>message<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token constant">PREFIX</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> input <span class="token operator">=</span> message<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token constant">PREFIX</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>input<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> command<span class="token punctuation">,</span> commandArgs<span class="token punctuation">]</span> <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/(\w+)\s*([\s\S]*)/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">===</span> <span class="token string">'balance'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// [gamma]</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">===</span> <span class="token string">'inventory'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// [delta]</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">===</span> <span class="token string">'transfer'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// [epsilon]</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">===</span> <span class="token string">'buy'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// [zeta]</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">===</span> <span class="token string">'shop'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// [theta]</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">===</span> <span class="token string">'leaderboard'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// [lambda]</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token string">'your-token-goes-here'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Nothing special about this skeleton. We import the Users and CurrencyShop models from our <code>dbObjects.js</code> file, and add a currency Collection. Every time someone talks, we add 1 to their currency count. The rest is just standard discord.js code and a simple if/else command handler. We're using the currency Collection in order to cache individual user's currency, so we don't have to hit the database for every lookup. I've used an if/else handler here, but you can put it in a framework or command handler as long as you maintain a reference to the models and the currency collection.</p> <h3 id="alpha-helper-methods"><a href="#alpha-helper-methods" class="header-anchor">#</a> [alpha] Helper methods</h3> <div class="language-js extra-class"><pre class="language-js"><code>Reflect<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>currency<span class="token punctuation">,</span> <span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token comment">/* eslint-disable-next-line func-name-matching */</span>
	<span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> amount</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> user <span class="token operator">=</span> currency<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			user<span class="token punctuation">.</span>balance <span class="token operator">+=</span> <span class="token function">Number</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">const</span> newUser <span class="token operator">=</span> <span class="token keyword">await</span> Users<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user_id<span class="token operator">:</span> id<span class="token punctuation">,</span> balance<span class="token operator">:</span> amount <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		currency<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> newUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> newUser<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Reflect<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>currency<span class="token punctuation">,</span> <span class="token string">'getBalance'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token comment">/* eslint-disable-next-line func-name-matching */</span>
	<span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> user <span class="token operator">=</span> currency<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> user <span class="token operator">?</span> user<span class="token punctuation">.</span>balance <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>We're defining an <code>.add()</code> method to our currency collection. It'll be used quite frequently, so having a method for it makes our lives easier. We'll also add a <code>.getBalance()</code> method so that we'll always get a number.</p> <h3 id="beta-ready-event-data-sync"><a href="#beta-ready-event-data-sync" class="header-anchor">#</a> [beta] Ready event data sync</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> storedBalances <span class="token operator">=</span> <span class="token keyword">await</span> Users<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
storedBalances<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">b</span> <span class="token operator">=&gt;</span> currency<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>user_id<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In our ready event, we want to sync our currency collection with the database for easy access later.</p> <h3 id="gamma-show-user-balance"><a href="#gamma-show-user-balance" class="header-anchor">#</a> [gamma] Show user balance</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> target <span class="token operator">=</span> message<span class="token punctuation">.</span>mentions<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> message<span class="token punctuation">.</span>author<span class="token punctuation">;</span>
<span class="token keyword">return</span> message<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>target<span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> has </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>currency<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Nothing tricky here. We use our <code>.getBalance()</code> method to show either the author's or the mentioned user's balance</p> <h3 id="delta-show-user-inventory"><a href="#delta-show-user-inventory" class="header-anchor">#</a> [delta] Show user inventory</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> target <span class="token operator">=</span> message<span class="token punctuation">.</span>mentions<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> message<span class="token punctuation">.</span>author<span class="token punctuation">;</span>
<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> Users<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> where<span class="token operator">:</span> <span class="token punctuation">{</span> user_id<span class="token operator">:</span> target<span class="token punctuation">.</span>id <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> items <span class="token operator">=</span> <span class="token keyword">await</span> user<span class="token punctuation">.</span><span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>items<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span> message<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>target<span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> has nothing!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> message<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>target<span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> currently has </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">i</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token punctuation">.</span>amount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token punctuation">.</span>item<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Here we begin to see the power of associations. Even though users and the shop are different tables, and the data is stored separately, we can get a user's inventory by looking at the junction table and join it with the shop. No duplicated item names that waste space!</p> <h3 id="epsilon-transfer-currency-to-another-user"><a href="#epsilon-transfer-currency-to-another-user" class="header-anchor">#</a> [epsilon] Transfer currency to another user</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> currentAmount <span class="token operator">=</span> currency<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>author<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> transferAmount <span class="token operator">=</span> commandArgs<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/ +/g</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">arg</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token regex">/&lt;@!?\d+&gt;/g</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> transferTarget <span class="token operator">=</span> message<span class="token punctuation">.</span>mentions<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>transferAmount <span class="token operator">||</span> <span class="token function">isNaN</span><span class="token punctuation">(</span>transferAmount<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> message<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Sorry </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token punctuation">.</span>author<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, that's an invalid amount.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>transferAmount <span class="token operator">&gt;</span> currentAmount<span class="token punctuation">)</span> <span class="token keyword">return</span> message<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Sorry </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token punctuation">.</span>author<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, you only have </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>currentAmount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>transferAmount <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> message<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Please enter an amount greater than zero, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token punctuation">.</span>author<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

currency<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>author<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token operator">-</span>transferAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>
currency<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>transferTarget<span class="token punctuation">.</span>id<span class="token punctuation">,</span> transferAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> message<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Successfully transferred </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>transferAmount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>transferTarget<span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. Your current balance is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>currency<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>author<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>As a bot creator, you should always be thinking about how to make the user experience better. Good UX makes users less frustrated with your commands. If your input are different types, don't make them memorize which parameters come before the other.</p> <p>We want to be able to allow users to do both <code>!transfer 5 @user</code> and <code>!transfer @user 5</code>. So what we're going to do is grab the first non-mention text in the command. In the second line of the above code, we split the command by spaces, and then we look for anything that doesn't match a mention, and we'll assume that's the transfer amount. Then we do some checking to make sure it's a valid input. You can also do error checking on the transfer target, but that's trivial, so it won't be included here.</p> <p>We use <code>.add()</code> for both removing and adding currency. Since we already check if the transfer amount is below zero, it will be safe to apply the additive inverse of the transfer amount to their balance.</p> <h3 id="zeta-buying-an-item"><a href="#zeta-buying-an-item" class="header-anchor">#</a> [zeta] Buying an item</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> item <span class="token operator">=</span> <span class="token keyword">await</span> CurrencyShop<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> where<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>Op<span class="token punctuation">.</span>like<span class="token punctuation">]</span><span class="token operator">:</span> commandArgs <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>item<span class="token punctuation">)</span> <span class="token keyword">return</span> message<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">That item doesn't exist.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>cost <span class="token operator">&gt;</span> currency<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>author<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> message<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You currently have </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>currency<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>author<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, but the </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> costs </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>cost<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> Users<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> where<span class="token operator">:</span> <span class="token punctuation">{</span> user_id<span class="token operator">:</span> message<span class="token punctuation">.</span>author<span class="token punctuation">.</span>id <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
currency<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>author<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token operator">-</span>item<span class="token punctuation">.</span>cost<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> user<span class="token punctuation">.</span><span class="token function">addItem</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>

message<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You've bought: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In order for users to search for an item without having to care about case, we use the <code>$iLike</code> modifier when we're looking for the name. Keep in mind that this may be slow if you have millions of items, so please don't put a million items in your shop.</p> <h3 id="theta-display-the-shop"><a href="#theta-display-the-shop" class="header-anchor">#</a> [theta] Display the shop</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> items <span class="token operator">=</span> <span class="token keyword">await</span> CurrencyShop<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> message<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>cost<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> code<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Nothing special here, just a regular <code>.findAll()</code> to get all the items in the shop, and <code>.map()</code> to transform that data into something nice looking.</p> <h3 id="lambda-display-the-leaderboard"><a href="#lambda-display-the-leaderboard" class="header-anchor">#</a> [lambda] Display the leaderboard</h3> <span style="display:none;"><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">return</span> message<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>
	currency<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> b<span class="token punctuation">.</span>balance <span class="token operator">-</span> a<span class="token punctuation">.</span>balance<span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">user</span> <span class="token operator">=&gt;</span> client<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>user_id<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">user<span class="token punctuation">,</span> position</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>position <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>user_id<span class="token punctuation">)</span><span class="token punctuation">.</span>tag<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>balance<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> code<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></span> <span style="display:block;"><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">return</span> message<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>
	currency<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> b<span class="token punctuation">.</span>balance <span class="token operator">-</span> a<span class="token punctuation">.</span>balance<span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">user</span> <span class="token operator">=&gt;</span> client<span class="token punctuation">.</span>users<span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>user_id<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">user<span class="token punctuation">,</span> position</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>position <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>users<span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>user_id<span class="token punctuation">)</span><span class="token punctuation">.</span>tag<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>balance<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> code<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></span> <p>Nothing particularly special here either. We could have queried the database for the top 10 currency holders as well, but we already have access to them locally, so just sort the Collection we have and use map again to display in a nice format. The filter is in case the users no longer exist in the bot's cache.</p> <h2 id="resulting-code"><a href="#resulting-code" class="header-anchor">#</a> Resulting code</h2> <p>
	If you want to compare your code to the code we've constructed so far, you can review it over on the GitHub repository
	<a href="https://github.com/discordjs/guide/tree/master/code-samples/" target="_blank" rel="noopener noreferrer">
		here <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.
</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/discordjs/guide/edit/master/guide/sequelize/currency.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/22/2020, 4:30:58 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="index.html" class="prev router-link-active">
        Storing data with Sequelize
      </a></span> <span class="next"><a href="../keyv/index.html">
        Storing data with Keyv
      </a>
      
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="../assets/js/app.1b16820c.js" defer></script><script src="../assets/js/4.58143105.js" defer></script><script src="../assets/js/21.c20bf682.js" defer></script><script src="../assets/js/16.e90c1593.js" defer></script><script src="../assets/js/22.549d06f2.js" defer></script><script src="../assets/js/6.1ed8886a.js" defer></script>
  </body>

<!-- Mirrored from discordjs.guide/sequelize/currency.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 17 Jan 2021 09:05:05 GMT -->
</html>
